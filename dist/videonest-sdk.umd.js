!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("debug"),require("react")):"function"==typeof define&&define.amd?define(["exports","debug","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VideonestSDK={},e.debugModule,e.React)}(this,(function(e,t,o){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(o){if("default"!==o){var r=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,r.get?r:{enumerable:!0,get:function(){return e[o]}})}})),t.default=e,Object.freeze(t)}var s=r(t),a=i(o);let n=!1;const d=s.default("videonest-sdk");function c(e,...t){n&&(console.log(`[videonest-sdk] ${e}`,...t),d(e,...t))}class l{constructor(e){this.config=e,function(e,...t){n&&d(e,...t)}("VideonestClient initialized with channelId:",e.channelId)}async uploadVideoDirectToS3(e,t,o,r,i,s){try{const a=t.length,n=new Array(a).fill(0),d=()=>{const e=n.reduce(((e,t)=>e+t),0);s(e/a)},c=t.map((async(t,o)=>{const r=o*i,s=Math.min(r+i,e.size),a=e.slice(r,s);if(0===a.size)throw new Error(`Empty chunk detected for part ${o+1}`);return new Promise(((e,r)=>{const i=new XMLHttpRequest;i.timeout=3e5,i.upload.onprogress=e=>{e.lengthComputable&&(n[o]=e.loaded/e.total*100,d())},i.onload=()=>{if(i.status>=200&&i.status<300){const t=i.getResponseHeader("ETag");if(!t)return void r(new Error(`No ETag received for part ${o+1}`));n[o]=100,d(),e({PartNumber:o+1,ETag:t.replace(/"/g,"")})}else r(new Error(`HTTP ${i.status}: Failed to upload part ${o+1}`))},i.onerror=()=>{r(new Error(`Network error uploading part ${o+1}`))},i.ontimeout=()=>{r(new Error(`Timeout uploading part ${o+1}`))},i.open("PUT",t),i.setRequestHeader("Content-Type","application/octet-stream"),i.send(a)}))})),l=await Promise.all(c);return{success:!0,uploadId:o,s3Key:r,parts:l.sort(((e,t)=>e.PartNumber-t.PartNumber))}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Upload failed",uploadId:o,s3Key:r,parts:[]}}}async uploadVideo(e,t){c(`ðŸ“¤ Starting upload: ${e.name} (${(e.size/1024/1024).toFixed(1)}MB)`);try{const{metadata:o,onProgress:r=(e,t)=>{},thumbnail:i}=t;if(!i)throw r(0,"failed"),new Error("Thumbnail is required for video upload");const s={...o,channelId:this.config.channelId},a=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/generate-presigned-url`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({fileName:e.name,fileSize:e.size,contentType:e.type,metadata:s})});if(!a.ok)throw new Error(`Failed to generate presigned URLs: ${a.status}`);const n=await a.json();if(!n.success)throw new Error(n.error||"Failed to generate presigned URLs");r(0,"uploading");const d=await this.uploadVideoDirectToS3(e,n.presignedUrls,n.uploadId,n.s3Key,n.chunkSize,(e=>{r(e,"uploading")}));if(!d.success)throw new Error(d.error||"S3 upload failed");r(100,"finalizing");const l=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/complete-upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({uploadId:d.uploadId,s3Key:d.s3Key,parts:d.parts})});if(!l.ok)throw new Error(`Failed to complete upload: ${l.status}`);const u=await l.json();if(!u.success)throw new Error(u.message||"Upload completion failed");return await this.uploadThumbnail(i,u.data.videoId),c("âœ… Upload completed successfully:",u.data.videoId),{success:!0,message:"Video uploaded successfully",video:{id:u.data.videoId}}}catch(e){return c(`âŒ Upload failed: ${e instanceof Error?e.message:"Unknown error"}`),{success:!1,message:e instanceof Error?e.message:"An unexpected error occurred during upload"}}}async uploadThumbnail(e,t){const o=new FormData;o.append("thumbnail",e);try{const e=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/videos/${t}/send-thumbnail`,{method:"POST",body:o,headers:{Authorization:`Bearer ${this.config.apiKey}`}}),r=await e.json();if(!r.success)throw new Error(r.message||"Thumbnail upload failed");return r}catch(e){throw new Error(e instanceof Error?e.message:"Failed to upload thumbnail")}}async getVideoStatus(e){try{const t=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/videos/${e}/status`,{method:"GET",headers:{Authorization:`Bearer ${this.config.apiKey}`}}),o=await t.json();if(!o.success)throw new Error(o.message||"Failed to get video status");return o}catch(e){throw new Error(e instanceof Error?e.message:"Failed to get video status")}}async listVideos(){try{const e=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/videos`,{method:"GET",headers:{Authorization:`Bearer ${this.config.apiKey}`}}),t=await e.json();return t.success?t:{success:!1,message:t.message||"Failed to retrieve videos"}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Failed to retrieve videos"}}}}e.VideonestEmbed=({videoId:e,config:t,style:o={}})=>{const{primaryColor:r,secondaryColor:i,darkMode:s,width:n,height:d,showTitle:c,showDescription:l}=o;let u=`https://app.videonest.co/embed/single/${e}`;const p=[];return r&&p.push(`primary_color=${r.replace("#","")}`),i&&p.push(`secondary_color=${i.replace("#","")}`),s&&p.push("dark_mode=true"),c&&p.push("show_title=true"),l&&p.push("show_description=true"),p.push(`channel_id=${t.channelId}`),p.push(`api_key=${t.apiKey}`),p.length>0&&(u+=`?${p.join("&")}`),a.createElement("iframe",{src:u,style:{width:n||"100%",height:d||"100%"},frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:`Videonest video ${e}`})},e.VideonestPreview=({videoId:e,config:t,style:o={}})=>{const{primaryColor:r,secondaryColor:i,darkMode:s,width:n,height:d,showTitle:c,showDescription:l}=o;let u=`https://app.videonest.co/embed/preview/${e}`;const p=[];return r&&p.push(`primary_color=${r.replace("#","")}`),i&&p.push(`secondary_color=${i.replace("#","")}`),s&&p.push("dark_mode=true"),c&&p.push("show_title=true"),l&&p.push("show_description=true"),p.push(`channel_id=${t.channelId}`),p.push(`api_key=${t.apiKey}`),p.length>0&&(u+=`?${p.join("&")}`),a.createElement("iframe",{src:u,style:{width:n||"100%",height:d||"100%"},frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:`Videonest video ${e}`})},e.getVideoStatus=async function(e,t){return new l(t).getVideoStatus(e)},e.isDebugModeEnabled=function(){return n},e.listVideos=async function(e){return new l(e).listVideos()},e.setDebugMode=function(e){n=e,e?(s.default.enable("videonest-sdk"),"undefined"!=typeof window&&window.localStorage.setItem("debug","videonest-sdk")):(s.default.disable(),"undefined"!=typeof window&&window.localStorage.removeItem("debug"))},e.uploadVideo=async function(e,t,o){return new l(o).uploadVideo(e,t)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=videonest-sdk.umd.js.map
