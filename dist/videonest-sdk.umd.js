!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("debug"),require("react")):"function"==typeof define&&define.amd?define(["exports","debug","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VideonestSDK={},e.debugModule,e.React)}(this,(function(e,t,o){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(o){if("default"!==o){var r=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,r.get?r:{enumerable:!0,get:function(){return e[o]}})}})),t.default=e,Object.freeze(t)}var s=r(t),n=a(o);let i=!1;const d=s.default("videonest-sdk");const c=function(e,...t){i&&d(e,...t)};function l(e,...t){i&&(console.log(`[videonest-sdk] ${e}`,...t),d(e,...t))}class u{constructor(e){this.config=e,c("VideonestClient initialized with channelId:",e.channelId)}async uploadToS3(e,t,o,r,a,s){try{const n=t.length;c(`üöÄ Starting S3 upload: ${e.name} (${n} parts)`);const i=new Array(n).fill(0),d=()=>{const e=i.reduce(((e,t)=>e+t),0);s(e/n)},l=6,u=3,p=new Set,h=[],f=async(o,r=0)=>{const s=t[o],l=o*a,p=Math.min(l+a,e.size),h=e.slice(l,p);if(i[o]=0,d(),0===h.size)throw new Error(`Empty chunk detected for part ${o+1}`);return new Promise(((e,t)=>{const r=new XMLHttpRequest;r.timeout=6e4,r.upload.onprogress=e=>{e.lengthComputable&&(i[o]=e.loaded/e.total*100,d())},r.onload=()=>{if(r.status>=200&&r.status<300){const a=r.getResponseHeader("ETag");if(!a)return void t(new Error(`No ETag received for part ${o+1}`));i[o]=100,d(),c(`‚úÖ Chunk ${o+1}/${n} completed`),e({PartNumber:o+1,ETag:a.replace(/"/g,"")})}else t(new Error(`HTTP ${r.status}: Failed to upload part ${o+1}`))},r.onerror=()=>t(new Error(`Network error uploading part ${o+1}`)),r.ontimeout=()=>t(new Error(`Timeout uploading part ${o+1}`)),r.open("PUT",s),r.setRequestHeader("Content-Type","application/octet-stream"),r.send(h)})).catch((async e=>{if(r<u)return c(`‚ö†Ô∏è Chunk ${o+1} failed, retrying (${r+1}/${u}): ${e.message}`),await new Promise((e=>setTimeout(e,1e3*Math.pow(2,r)))),f(o,r+1);throw c(`‚ùå Chunk ${o+1} failed after ${u} retries: ${e.message}`),e}))};for(let e=0;e<t.length;e++){p.size>=l&&await Promise.race(p);const t=f(e).then((e=>(h.push(e),c(`üìä Progress: ${h.length}/${n} chunks completed (${Math.round(h.length/n*100)}%)`),e))).catch((t=>{throw c(`üí• Chunk ${e+1}/${n} permanently failed: ${t.message}`),t})).finally((()=>p.delete(t)));p.add(t)}await Promise.all(p);const g=h.sort(((e,t)=>e.PartNumber-t.PartNumber));return c(`‚úÖ S3 upload completed: ${e.name} (${g.length} parts)`),{success:!0,uploadId:o,s3Key:r,parts:g}}catch(e){const t=e instanceof Error?e.message:"Failed to upload to S3";return c(`‚ùå S3 upload failed: ${t}`),{success:!1,uploadId:o,s3Key:r,parts:[],error:t}}}async uploadVideo(e,t){l(`üì§ Starting upload: ${e.name} (${(e.size/1024/1024).toFixed(1)}MB)`);try{const{metadata:o,onProgress:r=(e,t)=>{},thumbnail:a}=t;if(!a)throw r(0,"failed"),new Error("Thumbnail is required for video upload");const s={...o,channelId:this.config.channelId},n=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/generate-presigned-url`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({fileName:e.name,fileSize:e.size,contentType:e.type,metadata:s})});if(!n.ok)throw new Error(`Failed to generate presigned URLs: ${n.status}`);const i=await n.json();if(!i.success)throw new Error(i.error||"Failed to generate presigned URLs");r(0,"uploading");const d=await this.uploadToS3(e,i.presignedUrls,i.uploadId,i.s3Key,i.chunkSize,(e=>{r(e,"uploading")}));if(!d.success)throw new Error(d.error||"S3 upload failed");r(100,"finalizing");const c=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/complete-upload`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({uploadId:d.uploadId,s3Key:d.s3Key,parts:d.parts})});if(!c.ok)throw new Error(`Failed to complete upload: ${c.status}`);const u=await c.json();if(!u.success)throw new Error(u.message||"Upload completion failed");return await this.uploadThumbnail(a,u.data.videoId),l("‚úÖ Upload completed successfully:",u.data.videoId),{success:!0,message:"Video uploaded successfully",video:{id:u.data.videoId}}}catch(e){return l(`‚ùå Upload failed: ${e instanceof Error?e.message:"Unknown error"}`),{success:!1,message:e instanceof Error?e.message:"An unexpected error occurred during upload"}}}async uploadThumbnail(e,t){const o=new FormData;o.append("thumbnail",e);try{const e=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/videos/${t}/send-thumbnail`,{method:"POST",body:o,headers:{Authorization:`Bearer ${this.config.apiKey}`}}),r=await e.json();if(!r.success)throw new Error(r.message||"Thumbnail upload failed");return r}catch(e){throw new Error(e instanceof Error?e.message:"Failed to upload thumbnail")}}async getVideoStatus(e){try{const t=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/videos/${e}/status`,{method:"GET",headers:{Authorization:`Bearer ${this.config.apiKey}`}}),o=await t.json();if(!o.success)throw new Error(o.message||"Failed to get video status");return o}catch(e){throw new Error(e instanceof Error?e.message:"Failed to get video status")}}async listVideos(){try{const e=await fetch(`https://api1.videonest.co/sdk/${this.config.channelId}/videos`,{method:"GET",headers:{Authorization:`Bearer ${this.config.apiKey}`}}),t=await e.json();return t.success?t:{success:!1,message:t.message||"Failed to retrieve videos"}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Failed to retrieve videos"}}}}e.VideonestEmbed=({videoId:e,config:t,style:o={}})=>{const{primaryColor:r,secondaryColor:a,darkMode:s,width:i,height:d,showTitle:c,showDescription:l}=o;let u=`https://app.videonest.co/embed/single/${e}`;const p=[];return r&&p.push(`primary_color=${r.replace("#","")}`),a&&p.push(`secondary_color=${a.replace("#","")}`),s&&p.push("dark_mode=true"),c&&p.push("show_title=true"),l&&p.push("show_description=true"),p.push(`channel_id=${t.channelId}`),p.push(`api_key=${t.apiKey}`),p.length>0&&(u+=`?${p.join("&")}`),n.createElement("iframe",{src:u,style:{width:i||"100%",height:d||"100%"},frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:`Videonest video ${e}`})},e.VideonestPreview=({videoId:e,config:t,style:o={}})=>{const{primaryColor:r,secondaryColor:a,darkMode:s,width:i,height:d,showTitle:c,showDescription:l}=o;let u=`https://app.videonest.co/embed/preview/${e}`;const p=[];return r&&p.push(`primary_color=${r.replace("#","")}`),a&&p.push(`secondary_color=${a.replace("#","")}`),s&&p.push("dark_mode=true"),c&&p.push("show_title=true"),l&&p.push("show_description=true"),p.push(`channel_id=${t.channelId}`),p.push(`api_key=${t.apiKey}`),p.length>0&&(u+=`?${p.join("&")}`),n.createElement("iframe",{src:u,style:{width:i||"100%",height:d||"100%"},frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:`Videonest video ${e}`})},e.getVideoStatus=async function(e,t){return new u(t).getVideoStatus(e)},e.isDebugModeEnabled=function(){return i},e.listVideos=async function(e){return new u(e).listVideos()},e.setDebugMode=function(e){i=e,e?(s.default.enable("videonest-sdk"),"undefined"!=typeof window&&window.localStorage.setItem("debug","videonest-sdk")):(s.default.disable(),"undefined"!=typeof window&&window.localStorage.removeItem("debug"))},e.uploadVideo=async function(e,t,o){return new u(o).uploadVideo(e,t)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=videonest-sdk.umd.js.map
